---
verbosity: "trace"
address: 0.0.0.0:2053
table:
  # [1] handle ipv6
  start:
    if: "qtype([AAAA])"
    then:
      # A list of actions is allowed here
      - blackhole
      # The next tag to go
      - end
    else:
      - blocklist
  # [2] ban all the blocklist.txt[dynamic generate from blocklist.url]
  blocklist:
    if: domain([file("./blocklist.txt")])
    then:
      - blackhole
      - end
    else:
      - query:
          tag: gfw
          #cache_policy: standard
      - end

upstreams:
  cloudflareDoH:
    https:
      uri: https://cloudflare-dns.com/dns-query
      ratelimit: 3000
      timeout: 2
      addr: 1.0.0.1

  quad9DoH:
    https:
      uri: https://quad9.net/dns-query
      ratelimit: 3000
      timeout: 2
      addr: 9.9.9.9

  opendnsDoH:
    https:
      uri: https://doh.opendns.com/dns-query
      ratelimit: 3000
      timeout: 2
      addr: 146.112.41.2

  googleDoH:
    https:
      uri: https://dns.google/dns-query
      ratelimit: 3000
      timeout: 2
      addr: 8.8.4.4

  gfw:
    hybrid:
      - googleDoH
      - opendnsDoH
      - quad9DoH
      - cloudflareDoH
